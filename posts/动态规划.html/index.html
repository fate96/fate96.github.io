<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>动态规划 - Luckyouo Blog</title><meta name=Description content="动态规划"><meta property="og:title" content="动态规划"><meta property="og:description" content="动态规划"><meta property="og:type" content="article"><meta property="og:url" content="https://luckyouo.github.io/posts/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92.html/"><meta property="og:image" content="https://luckyouo.github.io/logo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-04-03T10:30:45+08:00"><meta property="article:modified_time" content="2022-07-09T13:58:35+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://luckyouo.github.io/logo.png"><meta name=twitter:title content="动态规划"><meta name=twitter:description content="动态规划"><meta name=application-name content="LoveIt"><meta name=apple-mobile-web-app-title content="LoveIt"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://luckyouo.github.io/posts/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92.html/><link rel=prev href=https://luckyouo.github.io/posts/%E5%8D%9A%E5%BC%88%E8%AE%BA.html/><link rel=next href=https://luckyouo.github.io/posts/%E7%BA%BF%E6%AE%B5%E6%A0%91.html/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"动态规划","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/luckyouo.github.io\/posts\/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92.html\/"},"genre":"posts","keywords":"区间动态规划, 动态规划, 回文序列, 最长递增序列","wordcount":3296,"url":"https:\/\/luckyouo.github.io\/posts\/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92.html\/","datePublished":"2022-04-03T10:30:45+08:00","dateModified":"2022-07-09T13:58:35+08:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"luckyouo"},"description":"动态规划"}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><a href=https://github.com/luckyouo class=github-corner target=_blank title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="3.5rem" height="3.5rem" viewBox="0 0 250 250" style="fill:#70b7fd;color:#fff;position:absolute;top:0;border:0;left:0;transform:scale(-1,1)" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><div class=header-title><a href=/ title="Luckyouo Blog">Luckyouo Blogs</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>归档 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>分类 </a><a class=menu-item href=/friends/><i class='fas fa-fw fa-fan fa-spin'></i> 友链 </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin"></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Luckyouo Blog">Luckyouo Blogs</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/posts/ title>归档</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/categories/ title>分类</a><a class=menu-item href=/friends/ title><i class='fas fa-fw fa-fan fa-spin'></i>友链</a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class="toc-content always-active" id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animated flipInX">动态规划</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw"></i>luckyouo</a></span>&nbsp;<span class=post-category>收录于 <a href=/categories/%E7%AE%97%E6%B3%95/><i class="far fa-folder fa-fw"></i>算法</a></span></div><div class=post-meta-line><i class="far fa-calendar fa-fw"></i>&nbsp;<time datetime=2022-04-03>2022-04-03</time>&nbsp;<i class="far fa-calendar-plus fa-fw"></i>&nbsp;<time datetime=2022-07-09>2022-07-09</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 3296 字&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 7 分钟&nbsp;</div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ol><li><a href=#前言>前言</a></li><li><a href=#解题思路>解题思路</a></li><li><a href=#代码实现>代码实现</a><ol><li><a href=#剑指-offer-ii-093-最长斐波那契数列httpsleetcode-cncomproblemsq91fma><a href=https://leetcode-cn.com/problems/Q91FMA/>剑指 Offer II 093. 最长斐波那契数列</a></a></li><li><a href=#300-最长递增子序列httpsleetcodecnproblemslongest-increasing-subsequence><a href=https://leetcode.cn/problems/longest-increasing-subsequence/>300. 最长递增子序列</a></a></li><li><a href=#再优化>再优化</a></li><li><a href=#516-最长回文子序列httpsleetcodecnproblemslongest-palindromic-subsequence><a href=https://leetcode.cn/problems/longest-palindromic-subsequence/>516. 最长回文子序列</a></a></li><li><a href=#647-回文子串httpsleetcodecnproblemspalindromic-substrings><a href=https://leetcode.cn/problems/palindromic-substrings/>647. 回文子串</a></a></li><li><a href=#940-不同的子序列-iihttpsleetcodecnproblemsdistinct-subsequences-ii><a href=https://leetcode.cn/problems/distinct-subsequences-ii/>940. 不同的子序列 II</a></a></li><li><a href=#计数问题-dp>计数问题 DP</a></li></ol></li><li><a href=#参考资料>参考资料</a></li></ol></nav></div></div><div class=content id=content><h2 id=前言>前言</h2><p>动态规划与分治方法类似，通过组合子问题解决原问题。动态规划应用与子问题重叠的情况，及不同的子问题具有公共 的子子问题的解。动态规划只能应用于有<strong>最优子结构</strong>的问题。最优子结构的意思是局部最优解能决定全局最优解（对有些问题这个要求并不能完全满足，故有时需要引入一定的近似）。简单地说，问题能够分解成子问题来解决。</p><p>适用情况 (摘自 <a href=https://zh.wikipedia.org/wiki/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92 target=_blank rel="noopener noreffer">维基百科 动态规划</a>) ：</p><ol><li>最优子结构性质。如果问题的最优解所包含的子问题的解也是最优的，我们就称该问题具有最优子结构性质（即满足最优化原理）。最优子结构性质为动态规划算法解决问题提供了重要线索。</li><li>无后效性。即子问题的解一旦确定，就不再改变，不受在这之后、包含它的更大的问题的求解决策影响。</li><li>子问题重叠性质。子问题重叠性质是指在用递归算法自顶向下对问题进行求解时，每次产生的子问题并不总是新问题，有些子问题会被重复计算多次。动态规划算法正是利用了这种子问题的重叠性质，对每一个子问题只计算一次，然后将其计算结果保存在一个表格中，当再次需要计算已经计算过的子问题时，只是在表格中简单地查看一下结果，从而获得较高的效率，降低了时间复杂度。</li></ol><h2 id=解题思路>解题思路</h2><p>动态规划算法主要通过四个步骤来设计</p><ol><li>刻画一个最优解的结构特征</li><li>递归定义最优解</li><li>计算最优解的值（自底向上或带备忘的自顶向下，大部分使用自底向上)</li><li>利用计算的信息构造最优解</li></ol><h2 id=代码实现>代码实现</h2><h3 id=剑指-offer-ii-093-最长斐波那契数列httpsleetcode-cncomproblemsq91fma><a href=https://leetcode-cn.com/problems/Q91FMA/ target=_blank rel="noopener noreffer">剑指 Offer II 093. 最长斐波那契数列</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl>如果序列 X_1, X_2, ..., X_n 满足下列条件，就说它是 斐波那契式 的：
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>n &gt;= 3
</span></span><span class=line><span class=cl>对于所有 i + 2 <span class=err>&lt;</span>= n，都有 X_i + X_{i+1} = X_{i+2}
</span></span><span class=line><span class=cl>给定一个严格递增的正整数数组形成序列 arr ，找到 arr 中最长的斐波那契式的子序列的长度。如果一个不存在，返回  0 。
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>（回想一下，子序列是从原序列  arr 中派生出来的，它从 arr 中删掉任意数量的元素（也可以不删），而不改变其余元素的顺序。例如， [3, 5, 8] 是 [3, 4, 5, 6, 7, 8] 的一个子序列）
</span></span></code></pre></td></tr></table></div></div><p>斐波纳契数列长度主要观察最后两位，若后续值可以等于最后两位的和，则表示可以将该数加入对应的数列当中。于是可以使用<code>dp[i][j]</code>：表示以arr[i] , arr[j]结尾的斐波那契数列的最大长度。若 arr[j] - arr[i] 存在数列当中，且索引小于 <code>i</code> 时，记为 <code>k</code> ，则 <code>dp[i][j]</code> 需要进行更新，<code>dp[i][j] = max(dp[i][j], dp[k][i] + 1)</code> 。</p><p>为了降低确认 <strong>差值</strong> 是否存在数列当中且索引低于 <code>i</code> ，可以先将数列存入哈希表当中，其中 <code>Key</code> 为值， <code>Value</code> 为索引。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>class</span> <span class=nc>Solution</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>lenLongestFibSubseq</span><span class=o>(</span><span class=kt>int</span><span class=o>[]</span> <span class=n>arr</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>n</span> <span class=o>=</span> <span class=n>arr</span><span class=o>.</span><span class=na>length</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=n>Map</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>,</span> <span class=n>Integer</span><span class=o>&gt;</span> <span class=n>map</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashMap</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span><span class=o>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=n>0</span><span class=o>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>n</span><span class=o>;</span> <span class=n>i</span><span class=o>++){</span>
</span></span><span class=line><span class=cl>            <span class=n>map</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>arr</span><span class=o>[</span><span class=n>i</span><span class=o>],</span> <span class=n>i</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kt>int</span><span class=o>[][]</span> <span class=n>dp</span> <span class=o>=</span> <span class=k>new</span> <span class=kt>int</span><span class=o>[</span><span class=n>n</span><span class=o>][</span><span class=n>n</span><span class=o>]</span><span class=err>；</span>    
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>max</span> <span class=o>=</span> <span class=n>0</span><span class=o>;</span>
</span></span><span class=line><span class=cl>	    <span class=k>for</span><span class=o>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=n>0</span><span class=o>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>n</span> <span class=o>-</span> <span class=n>1</span><span class=o>;</span> <span class=n>i</span><span class=o>++)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>	    	<span class=k>for</span><span class=o>(</span><span class=kt>int</span> <span class=n>j</span> <span class=o>=</span> <span class=n>i</span> <span class=o>+</span> <span class=n>1</span><span class=o>;</span> <span class=n>j</span> <span class=o>&lt;</span> <span class=n>n</span><span class=o>;</span> <span class=n>j</span><span class=o>++)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>	    		<span class=kt>int</span> <span class=n>temp</span> <span class=o>=</span> <span class=n>arr</span><span class=o>[</span><span class=n>j</span><span class=o>]</span> <span class=o>-</span> <span class=n>arr</span><span class=o>[</span><span class=n>i</span><span class=o>];</span>
</span></span><span class=line><span class=cl>	    		<span class=kt>int</span> <span class=n>index</span> <span class=o>=</span> <span class=n>map</span><span class=o>.</span><span class=na>getOrDefault</span><span class=o>(</span><span class=n>temp</span><span class=o>,</span> <span class=o>-</span><span class=n>1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>	    		<span class=k>if</span><span class=o>(</span><span class=n>index</span> <span class=o>&gt;</span> <span class=o>-</span><span class=n>1</span> <span class=o>&amp;&amp;</span> <span class=n>index</span> <span class=o>&lt;</span> <span class=n>i</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>	    			<span class=n>dp</span><span class=o>[</span><span class=n>i</span><span class=o>][</span><span class=n>j</span><span class=o>]</span> <span class=o>=</span> <span class=n>dp</span><span class=o>[</span><span class=n>index</span><span class=o>][</span><span class=n>i</span><span class=o>]</span> <span class=o>+</span> <span class=n>1</span><span class=o>;</span>
</span></span><span class=line><span class=cl>	    			<span class=n>max</span> <span class=o>=</span> <span class=n>Math</span><span class=o>.</span><span class=na>max</span><span class=o>(</span><span class=n>max</span><span class=o>,</span> <span class=n>dp</span><span class=o>[</span><span class=n>i</span><span class=o>][</span><span class=n>j</span><span class=o>]</span> <span class=o>+</span> <span class=n>2</span><span class=o>);</span>
</span></span><span class=line><span class=cl>	    		<span class=o>}</span>
</span></span><span class=line><span class=cl>	    	<span class=o>}</span>
</span></span><span class=line><span class=cl>	    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>max</span> <span class=o>&gt;</span> <span class=n>2</span> <span class=o>?</span> <span class=n>max</span> <span class=o>:</span> <span class=n>0</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>注：解该题的重要思路就是确认 <code>dp</code> 数组表示的内容，即表示到达 <code>i</code> 和 <code>j</code> 的斐波纳契数列最大长度。</p><h3 id=300-最长递增子序列httpsleetcodecnproblemslongest-increasing-subsequence><a href=https://leetcode.cn/problems/longest-increasing-subsequence/ target=_blank rel="noopener noreffer">300. 最长递增子序列</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl>给你一个整数数组 nums ，找到其中最长严格递增子序列的长度。
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>子序列 是由数组派生而来的序列，删除（或不删除）数组中的元素而不改变其余元素的顺序。例如，[3,6,2,7] 是数组 [0,3,1,6,2,2,7] 的子序列
</span></span></code></pre></td></tr></table></div></div><p>求严格递增序列，当前位置若大于前面元素，则对应长度 + 1，否则最大长度不变，所以只需要求当前位置大于前面位置元素的最大长度。由此可以得到如下递推式子：</p><p>$$dp[i] = max(dp[i], dp[j])$$</p><p>其中 $ 0 &lt;= j &lt; i $</p><p>所以实现代码如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>class</span> <span class=nc>Solution</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>lengthOfLIS</span><span class=o>(</span><span class=kt>int</span><span class=o>[]</span> <span class=n>nums</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>n</span> <span class=o>=</span> <span class=n>nums</span><span class=o>.</span><span class=na>length</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span><span class=o>[]</span> <span class=n>dp</span> <span class=o>=</span> <span class=k>new</span> <span class=kt>int</span><span class=o>[</span><span class=n>n</span><span class=o>];</span>
</span></span><span class=line><span class=cl>        <span class=n>Arrays</span><span class=o>.</span><span class=na>fill</span><span class=o>(</span><span class=n>dp</span><span class=o>,</span> <span class=n>1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>max</span> <span class=o>=</span> <span class=n>1</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=n>1</span><span class=o>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>n</span><span class=o>;</span> <span class=n>i</span><span class=o>++)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>j</span> <span class=o>=</span> <span class=n>0</span><span class=o>;</span> <span class=n>j</span> <span class=o>&lt;</span> <span class=n>i</span><span class=o>;</span> <span class=n>j</span><span class=o>++)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span><span class=o>(</span><span class=n>nums</span><span class=o>[</span><span class=n>i</span><span class=o>]</span> <span class=o>&gt;</span> <span class=n>nums</span><span class=o>[</span><span class=n>j</span><span class=o>]){</span>
</span></span><span class=line><span class=cl>                    <span class=n>dp</span><span class=o>[</span><span class=n>i</span><span class=o>]</span> <span class=o>=</span> <span class=n>Math</span><span class=o>.</span><span class=na>max</span><span class=o>(</span><span class=n>dp</span><span class=o>[</span><span class=n>i</span><span class=o>],</span> <span class=n>dp</span><span class=o>[</span><span class=n>j</span><span class=o>]</span> <span class=o>+</span> <span class=n>1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=n>max</span> <span class=o>=</span> <span class=n>Math</span><span class=o>.</span><span class=na>max</span><span class=o>(</span><span class=n>max</span><span class=o>,</span> <span class=n>dp</span><span class=o>[</span><span class=n>i</span><span class=o>]);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>max</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=再优化>再优化</h3><p>更新 <code>dp</code> 数组时，上述代码采用的是暴力更新。因为数列是已经排序好了的，可以采用双指针进行遍历更新，从而减少时间复杂度，同时也不在需要哈希表了。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>class</span> <span class=nc>Solution</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>lenLongestFibSubseq</span><span class=o>(</span><span class=kt>int</span><span class=o>[]</span> <span class=n>arr</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>n</span> <span class=o>=</span> <span class=n>arr</span><span class=o>.</span><span class=na>length</span><span class=o>,</span> <span class=n>max</span> <span class=o>=</span> <span class=n>0</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span><span class=o>[][]</span> <span class=n>dp</span> <span class=o>=</span> <span class=k>new</span> <span class=kt>int</span><span class=o>[</span><span class=n>n</span><span class=o>][</span><span class=n>n</span><span class=o>];</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span><span class=o>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=n>2</span> <span class=o>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>n</span> <span class=o>;</span> <span class=n>i</span><span class=o>++){</span>
</span></span><span class=line><span class=cl>            <span class=kt>int</span> <span class=n>j</span> <span class=o>=</span> <span class=n>0</span><span class=o>,</span> <span class=n>k</span> <span class=o>=</span> <span class=n>i</span><span class=o>-</span><span class=n>1</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>while</span><span class=o>(</span><span class=n>j</span> <span class=o>&lt;</span> <span class=n>k</span><span class=o>){</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span><span class=o>(</span><span class=n>arr</span><span class=o>[</span><span class=n>j</span><span class=o>]</span> <span class=o>+</span> <span class=n>arr</span><span class=o>[</span><span class=n>k</span><span class=o>]</span> <span class=o>==</span> <span class=n>arr</span><span class=o>[</span><span class=n>i</span><span class=o>]){</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span><span class=o>(</span><span class=n>dp</span><span class=o>[</span><span class=n>j</span><span class=o>][</span><span class=n>k</span><span class=o>]</span> <span class=o>==</span> <span class=n>0</span><span class=o>){</span>
</span></span><span class=line><span class=cl>                        <span class=n>dp</span><span class=o>[</span><span class=n>k</span><span class=o>][</span><span class=n>i</span><span class=o>]</span> <span class=o>=</span> <span class=n>3</span><span class=o>;</span>
</span></span><span class=line><span class=cl>                    <span class=o>}</span><span class=k>else</span><span class=o>{</span>
</span></span><span class=line><span class=cl>                        <span class=n>dp</span><span class=o>[</span><span class=n>k</span><span class=o>][</span><span class=n>i</span><span class=o>]</span> <span class=o>=</span> <span class=n>Math</span><span class=o>.</span><span class=na>max</span><span class=o>(</span><span class=n>dp</span><span class=o>[</span><span class=n>j</span><span class=o>][</span><span class=n>k</span><span class=o>]+</span><span class=n>1</span><span class=o>,</span> <span class=n>dp</span><span class=o>[</span><span class=n>k</span><span class=o>][</span><span class=n>i</span><span class=o>]);</span>
</span></span><span class=line><span class=cl>                    <span class=o>}</span>
</span></span><span class=line><span class=cl>                    <span class=n>max</span> <span class=o>=</span> <span class=n>Math</span><span class=o>.</span><span class=na>max</span><span class=o>(</span><span class=n>max</span><span class=o>,</span> <span class=n>dp</span><span class=o>[</span><span class=n>k</span><span class=o>][</span><span class=n>i</span><span class=o>]);</span>
</span></span><span class=line><span class=cl>                    <span class=n>j</span><span class=o>++;</span><span class=n>k</span><span class=o>--;</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>                <span class=k>else</span> <span class=k>if</span><span class=o>(</span><span class=n>arr</span><span class=o>[</span><span class=n>j</span><span class=o>]</span> <span class=o>+</span> <span class=n>arr</span><span class=o>[</span><span class=n>k</span><span class=o>]</span> <span class=o>&lt;</span> <span class=n>arr</span><span class=o>[</span><span class=n>i</span><span class=o>]){</span>
</span></span><span class=line><span class=cl>                    <span class=n>j</span><span class=o>++;</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span><span class=k>else</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>k</span><span class=o>--;</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>max</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=516-最长回文子序列httpsleetcodecnproblemslongest-palindromic-subsequence><a href=https://leetcode.cn/problems/longest-palindromic-subsequence/ target=_blank rel="noopener noreffer">516. 最长回文子序列</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl>给你一个字符串 s ，找出其中最长的回文子序列，并返回该序列的长度。
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>子序列定义为：不改变剩余字符顺序的情况下，删除某些字符或者不删除任何字符形成的一个序列。
</span></span></code></pre></td></tr></table></div></div><p>回文序列和回文子串都是动态规划的经典题目。子串指的是连续字符回文，而序列则不需要连续。</p><p><strong>字串除了使用动态规划，还可以使用中心扩展法或者 Manacher 算法。</strong></p><p>使用 $dp[i][j]$ 表示从 $i$ 到 $j$ 的最长回文序列，当 $s[i] = s[j]$ 时，则 $dp[i][j] = dp[i+1][j-1] + 2$ ，否则 $dp[i][j] = max(dp[i+1][j], dp[i][j-1])$ ，根据状态转移公式可知，$i$ 需要从大到下遍历，而 $j$ 需要从小到大遍历，初始 $dp[i][i] = 1$。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>class</span> <span class=nc>Solution</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>longestPalindromeSubseq</span><span class=o>(</span><span class=n>String</span> <span class=n>s</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>n</span> <span class=o>=</span> <span class=n>s</span><span class=o>.</span><span class=na>length</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span><span class=o>[][]</span> <span class=n>dp</span> <span class=o>=</span> <span class=k>new</span> <span class=kt>int</span><span class=o>[</span><span class=n>n</span><span class=o>][</span><span class=n>n</span><span class=o>];</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=n>n</span><span class=o>-</span><span class=n>1</span><span class=o>;</span> <span class=n>i</span> <span class=o>&gt;=</span> <span class=n>0</span><span class=o>;</span> <span class=n>i</span><span class=o>--)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>dp</span><span class=o>[</span><span class=n>i</span><span class=o>][</span><span class=n>i</span><span class=o>]</span> <span class=o>=</span> <span class=n>1</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>j</span> <span class=o>=</span> <span class=n>i</span> <span class=o>+</span> <span class=n>1</span><span class=o>;</span> <span class=n>j</span> <span class=o>&lt;</span> <span class=n>n</span><span class=o>;</span> <span class=n>j</span><span class=o>++)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=o>(</span><span class=n>s</span><span class=o>.</span><span class=na>charAt</span><span class=o>(</span><span class=n>i</span><span class=o>)</span> <span class=o>==</span> <span class=n>s</span><span class=o>.</span><span class=na>charAt</span><span class=o>(</span><span class=n>j</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>dp</span><span class=o>[</span><span class=n>i</span><span class=o>][</span><span class=n>j</span><span class=o>]</span> <span class=o>=</span> <span class=n>dp</span><span class=o>[</span><span class=n>i</span> <span class=o>+</span> <span class=n>1</span><span class=o>][</span><span class=n>j</span> <span class=o>-</span> <span class=n>1</span><span class=o>]</span> <span class=o>+</span> <span class=n>2</span><span class=o>;</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>dp</span><span class=o>[</span><span class=n>i</span><span class=o>][</span><span class=n>j</span><span class=o>]</span> <span class=o>=</span> <span class=n>Math</span><span class=o>.</span><span class=na>max</span><span class=o>(</span><span class=n>dp</span><span class=o>[</span><span class=n>i</span> <span class=o>+</span> <span class=n>1</span><span class=o>][</span><span class=n>j</span><span class=o>],</span> <span class=n>dp</span><span class=o>[</span><span class=n>i</span><span class=o>][</span><span class=n>j</span> <span class=o>-</span> <span class=n>1</span><span class=o>]);</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>dp</span><span class=o>[</span><span class=n>0</span><span class=o>][</span><span class=n>n</span> <span class=o>-</span> <span class=n>1</span><span class=o>];</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=647-回文子串httpsleetcodecnproblemspalindromic-substrings><a href=https://leetcode.cn/problems/palindromic-substrings/ target=_blank rel="noopener noreffer">647. 回文子串</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl>给你一个字符串 s ，请你统计并返回这个字符串中 回文子串 的数目。
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>回文字符串 是正着读和倒过来读一样的字符串。
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>子字符串 是字符串中的由连续字符组成的一个序列。
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>具有不同开始位置或结束位置的子串，即使是由相同的字符组成，也会被视作不同的子串。
</span></span></code></pre></td></tr></table></div></div><p>使用 $dp[j]$ 表示 $j$ 到当前遍历 $i$ 是否为回文序列，若是，则计数 +1。因为 $i$ 和 $j$ 都为从左往右遍历，所以当前遍历的 $dp[j+1]$ 表示上一轮遍历值，即 $j+1$ 到 $i-1$ 是否为回文序列，则当前遍历轮次只需要判断 $s[i] == s[j] $ 和 $dp[j+1]$ 即可以判断 $j$ 至 $i$ 是否为回文序列。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>class</span> <span class=nc>Solution</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>countSubstrings</span><span class=o>(</span><span class=n>String</span> <span class=n>s</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>n</span> <span class=o>=</span> <span class=n>s</span><span class=o>.</span><span class=na>length</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span><span class=o>[]</span> <span class=n>dp</span> <span class=o>=</span> <span class=k>new</span> <span class=kt>int</span><span class=o>[</span><span class=n>n</span><span class=o>];</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>cnt</span> <span class=o>=</span> <span class=n>0</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=n>0</span><span class=o>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>n</span><span class=o>;</span> <span class=n>i</span><span class=o>++)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>dp</span><span class=o>[</span><span class=n>i</span><span class=o>]</span> <span class=o>=</span> <span class=n>1</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=n>cnt</span><span class=o>++;</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>j</span> <span class=o>=</span> <span class=n>0</span><span class=o>;</span> <span class=n>j</span> <span class=o>&lt;</span> <span class=n>i</span><span class=o>;</span> <span class=n>j</span><span class=o>++)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span><span class=o>(</span><span class=n>s</span><span class=o>.</span><span class=na>charAt</span><span class=o>(</span><span class=n>i</span><span class=o>)</span> <span class=o>==</span> <span class=n>s</span><span class=o>.</span><span class=na>charAt</span><span class=o>(</span><span class=n>j</span><span class=o>)</span> <span class=o>&amp;&amp;</span> <span class=n>dp</span><span class=o>[</span><span class=n>j</span><span class=o>+</span><span class=n>1</span><span class=o>]</span> <span class=o>==</span> <span class=n>1</span><span class=o>){</span>
</span></span><span class=line><span class=cl>                    <span class=n>dp</span><span class=o>[</span><span class=n>j</span><span class=o>]</span> <span class=o>=</span> <span class=n>1</span><span class=o>;</span>
</span></span><span class=line><span class=cl>                    <span class=n>cnt</span><span class=o>++;</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span><span class=k>else</span><span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>dp</span><span class=o>[</span><span class=n>j</span><span class=o>]</span> <span class=o>=</span> <span class=n>0</span><span class=o>;</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>cnt</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=940-不同的子序列-iihttpsleetcodecnproblemsdistinct-subsequences-ii><a href=https://leetcode.cn/problems/distinct-subsequences-ii/ target=_blank rel="noopener noreffer">940. 不同的子序列 II</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl>给定一个字符串 s，计算 s 的 不同非空子序列 的个数。因为结果可能很大，所以返回答案需要对 10^9 + 7 取余 。
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>字符串的 子序列 是经由原字符串删除一些（也可能不删除）字符但不改变剩余字符相对位置的一个新字符串。
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>例如，&#34;ace&#34; 是 &#34;abcde&#34; 的一个子序列，但 &#34;aec&#34; 不是。
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>1 <span class=err>&lt;</span>= s.length <span class=err>&lt;</span>= 2000
</span></span><span class=line><span class=cl>s 仅由小写英文字母组成
</span></span></code></pre></td></tr></table></div></div><p>当字符序列的元素数量固定时，比如序列中只含有小写字符，线性动态规划除了从序列长度开始规划外，也可以从子序列末尾元素结尾的元素类型进行规划。</p><p>先考虑从序列长度规划，容易知道 $dp[i] = 2 * dp[i - 1] - duplicate[c]$ ，其中 $c$ 是 $i$ 处字符，$duplicate[c]$ 表示之前以 $c$ 结尾的序列数量。</p><p>公式表示：在 $i$ 索引前的所有子序列和子序列与当前字符拼接的总数量和 - 重复序列数量，重复序列即之前 $c$ 结尾的子序列。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>class</span> <span class=nc>Solution</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>distinctSubseqII</span><span class=o>(</span><span class=n>String</span> <span class=n>S</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>MOD</span> <span class=o>=</span> <span class=n>1_000_000_007</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>N</span> <span class=o>=</span> <span class=n>S</span><span class=o>.</span><span class=na>length</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span><span class=o>[]</span> <span class=n>dp</span> <span class=o>=</span> <span class=k>new</span> <span class=kt>int</span><span class=o>[</span><span class=n>N</span><span class=o>+</span><span class=n>1</span><span class=o>];</span>
</span></span><span class=line><span class=cl>        <span class=n>dp</span><span class=o>[</span><span class=n>0</span><span class=o>]</span> <span class=o>=</span> <span class=n>1</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kt>int</span><span class=o>[]</span> <span class=n>last</span> <span class=o>=</span> <span class=k>new</span> <span class=kt>int</span><span class=o>[</span><span class=n>26</span><span class=o>];</span>
</span></span><span class=line><span class=cl>        <span class=n>Arrays</span><span class=o>.</span><span class=na>fill</span><span class=o>(</span><span class=n>last</span><span class=o>,</span> <span class=o>-</span><span class=n>1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=n>0</span><span class=o>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>N</span><span class=o>;</span> <span class=o>++</span><span class=n>i</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=kt>int</span> <span class=n>x</span> <span class=o>=</span> <span class=n>S</span><span class=o>.</span><span class=na>charAt</span><span class=o>(</span><span class=n>i</span><span class=o>)</span> <span class=o>-</span> <span class=sc>&#39;a&#39;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=n>dp</span><span class=o>[</span><span class=n>i</span><span class=o>+</span><span class=n>1</span><span class=o>]</span> <span class=o>=</span> <span class=n>dp</span><span class=o>[</span><span class=n>i</span><span class=o>]</span> <span class=o>*</span> <span class=n>2</span> <span class=o>%</span> <span class=n>MOD</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=o>(</span><span class=n>last</span><span class=o>[</span><span class=n>x</span><span class=o>]</span> <span class=o>&gt;=</span> <span class=n>0</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                <span class=n>dp</span><span class=o>[</span><span class=n>i</span><span class=o>+</span><span class=n>1</span><span class=o>]</span> <span class=o>-=</span> <span class=n>dp</span><span class=o>[</span><span class=n>last</span><span class=o>[</span><span class=n>x</span><span class=o>]];</span>
</span></span><span class=line><span class=cl>            <span class=n>dp</span><span class=o>[</span><span class=n>i</span><span class=o>+</span><span class=n>1</span><span class=o>]</span> <span class=o>%=</span> <span class=n>MOD</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=n>last</span><span class=o>[</span><span class=n>x</span><span class=o>]</span> <span class=o>=</span> <span class=n>i</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>dp</span><span class=o>[</span><span class=n>N</span><span class=o>]--;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>dp</span><span class=o>[</span><span class=n>N</span><span class=o>]</span> <span class=o>&lt;</span> <span class=n>0</span><span class=o>)</span> <span class=n>dp</span><span class=o>[</span><span class=n>N</span><span class=o>]</span> <span class=o>+=</span> <span class=n>MOD</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>dp</span><span class=o>[</span><span class=n>N</span><span class=o>];</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>由于递推公式 $dp$ 只与之前的元素有关，因此可以使用滚动数组表示，而此时就相当于使用序列末尾元素进行动态规划，公式如下：$dp[c] = sum + 1$ ，其中 $dp[c]$ 表示以 $c$ 结尾的总序列数量， $sum$ 表示字符 $c$ 之前的总序列数量，将之前的总序列后拼接当前元素的数量+单个元素 $1$，即当前以 $c$ 结尾的总序列数量。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>class</span> <span class=nc>Solution</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>distinctSubseqII</span><span class=o>(</span><span class=n>String</span> <span class=n>s</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span><span class=o>[]</span> <span class=n>dp</span> <span class=o>=</span> <span class=k>new</span> <span class=kt>int</span><span class=o>[</span><span class=n>26</span><span class=o>];</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>MOD</span> <span class=o>=</span> <span class=o>(</span><span class=kt>int</span><span class=o>)</span> <span class=o>(</span><span class=n>1e9</span><span class=o>+</span> <span class=n>7</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=kt>long</span> <span class=n>sum</span> <span class=o>=</span> <span class=n>0</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=o>(</span><span class=kt>char</span> <span class=n>c</span> <span class=o>:</span> <span class=n>s</span><span class=o>.</span><span class=na>toCharArray</span><span class=o>())</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// 先前的以 c 结尾的序列数量
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=kt>long</span> <span class=n>pre</span> <span class=o>=</span> <span class=n>dp</span><span class=o>[</span><span class=n>c</span> <span class=o>-</span> <span class=sc>&#39;a&#39;</span><span class=o>];</span>
</span></span><span class=line><span class=cl>            <span class=c1>// 当前以 c 结尾的序列数量
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=n>dp</span><span class=o>[</span><span class=n>c</span> <span class=o>-</span> <span class=sc>&#39;a&#39;</span><span class=o>]</span> <span class=o>=</span> <span class=o>(</span><span class=kt>int</span><span class=o>)</span> <span class=o>((</span><span class=n>sum</span> <span class=o>+</span> <span class=n>1</span><span class=o>)</span> <span class=o>%</span> <span class=n>MOD</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=c1>// 当前序列总数量
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=n>sum</span> <span class=o>=</span> <span class=o>(</span><span class=n>sum</span> <span class=o>-</span> <span class=n>pre</span> <span class=o>+</span> <span class=n>dp</span><span class=o>[</span><span class=n>c</span> <span class=o>-</span> <span class=sc>&#39;a&#39;</span><span class=o>])</span> <span class=o>%</span> <span class=n>MOD</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=o>(</span><span class=kt>int</span><span class=o>)</span> <span class=o>(</span><span class=n>sum</span> <span class=o>+</span> <span class=n>MOD</span><span class=o>)</span> <span class=o>%</span> <span class=n>MOD</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=计数问题-dp>计数问题 DP</h3><p>动态规划除了求解最优问题，还可以用来求排列组合、概率和期望。例如 n 的 m 划分问题</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl>有 n 个无区别的物品，将他们划分为不超过 m 组，求划分方法数对 M 去模
</span></span></code></pre></td></tr></table></div></div><p>对该问题使用动态规划最关键的问题是，如何避免重复计数。常见的犯错问题是使用如下递推方程</p><p>$$dp[i][j] = \sum_{k=0}^jdp[i-1[j-k]$$</p><p>例如 1 + 1 + 2 和 1+ 2+ 1 就分别当做两种不同的划分方式了。</p><p>实际上，可以使用如下递推方程</p><p>$$dp[i][j] = dp[i][j-i] + dp[i-1][j]$$</p><p>$dp[i][j]$ 表示将 $j $ 划分为 $i$ 组，当 $j$ 划分为 $i$ 组后，记为 $a_i$ ，则 $a_i - 1$ 可以看作为 $j - i$ 划分为 $i$ 组，而若$a_i =0$时，则表示将 $j$ 划分为 $i - 1$ 组</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kt>int</span><span class=o>[][]</span> <span class=n>dp</span> <span class=o>=</span> <span class=k>new</span> <span class=kt>int</span><span class=o>[</span><span class=n>m</span><span class=o>+</span><span class=n>1</span><span class=o>][</span><span class=n>n</span><span class=o>+</span><span class=n>1</span><span class=o>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>dp</span><span class=o>[</span><span class=n>0</span><span class=o>][</span><span class=n>0</span><span class=o>]</span> <span class=o>=</span> <span class=n>1</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=k>for</span><span class=o>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=n>1</span><span class=o>;</span> <span class=n>i</span> <span class=o>&lt;=</span> <span class=n>m</span><span class=o>;</span> <span class=n>i</span><span class=o>++){</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span><span class=o>(</span><span class=kt>int</span> <span class=n>j</span> <span class=o>=</span> <span class=n>1</span><span class=o>;</span> <span class=n>j</span> <span class=o>&lt;=</span> <span class=n>n</span><span class=o>;</span> <span class=n>j</span><span class=o>++){</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=o>(</span><span class=n>j</span> <span class=o>-</span> <span class=n>i</span> <span class=o>&gt;=</span> <span class=n>0</span><span class=o>){</span>
</span></span><span class=line><span class=cl>            <span class=n>dp</span><span class=o>[</span><span class=n>i</span><span class=o>][</span><span class=n>j</span><span class=o>]</span> <span class=o>=</span> <span class=o>(</span><span class=n>dp</span><span class=o>[</span><span class=n>i</span> <span class=o>-</span> <span class=n>1</span><span class=o>][</span><span class=n>j</span><span class=o>]</span> <span class=o>+</span> <span class=n>dp</span><span class=o>[</span><span class=n>i</span><span class=o>][</span><span class=n>j</span><span class=o>-</span><span class=n>i</span><span class=o>])</span> <span class=o>%</span> <span class=n>M</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span><span class=k>else</span><span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>dp</span><span class=o>[</span><span class=n>i</span><span class=o>][</span><span class=n>j</span><span class=o>]</span> <span class=o>=</span> <span class=n>dp</span><span class=o>[</span><span class=n>i</span><span class=o>-</span><span class=n>1</span><span class=o>][</span><span class=n>j</span><span class=o>];</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p><em>注：将基数为 n 划分为 k 各非空集的方法的数目称为第二类 Stirling 数，而将基数 n 的集合划分为任意非空集合的方法的数目的数目称为 Bell 数</em></p><h2 id=参考资料>参考资料</h2><p><a href=https://zh.wikipedia.org/wiki/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92 target=_blank rel="noopener noreffer">动态规划</a><a href=https://leetcode-cn.com/problems/length-of-longest-fibonacci-subsequence/solution/zhuang-tai-ding-yi-hen-shi-zhong-yao-by-christmas_/ target=_blank rel="noopener noreffer">状态定义很是重要！</a></p><p><a href=https://book.douban.com/subject/20432061/ target=_blank rel="noopener noreffer">算法导论</a></p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2022-07-09</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/posts/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92.html/index.md target=_blank>阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://luckyouo.github.io/posts/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92.html/ data-title=动态规划 data-via=xxxx data-hashtags=区间动态规划,动态规划,回文序列,最长递增序列><i class="fab fa-twitter fa-fw"></i></a><a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://luckyouo.github.io/posts/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92.html/ data-hashtag=区间动态规划><i class="fab fa-facebook-square fa-fw"></i></a><a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://luckyouo.github.io/posts/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92.html/ data-title=动态规划><i class="fab fa-weibo fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/%E5%8C%BA%E9%97%B4%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/>区间动态规划</a>,&nbsp;<a href=/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/>动态规划</a>,&nbsp;<a href=/tags/%E5%9B%9E%E6%96%87%E5%BA%8F%E5%88%97/>回文序列</a>,&nbsp;<a href=/tags/%E6%9C%80%E9%95%BF%E9%80%92%E5%A2%9E%E5%BA%8F%E5%88%97/>最长递增序列</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/posts/%E5%8D%9A%E5%BC%88%E8%AE%BA.html/ class=prev rel=prev title=博弈论><i class="fas fa-angle-left fa-fw"></i>博弈论</a>
<a href=/posts/%E7%BA%BF%E6%AE%B5%E6%A0%91.html/ class=next rel=next title=线段树>线段树<i class="fas fa-angle-right fa-fw"></i></a></div></div><div id=comments></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line><span id=run-time></span></div><div class=footer-line>由 <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.105.0">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>luckyouo</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw"></i></a></div><div class=sidebar_wo><div id=leimu><img src=https://cdn.jsdelivr.net/gh/lewky/lewky.github.io@master/images/b2t/leimuA.png alt=雷姆 onmouseover='this.src="https://cdn.jsdelivr.net/gh/lewky/lewky.github.io@master/images/b2t/leimuB.png"' onmouseout='this.src="https://cdn.jsdelivr.net/gh/lewky/lewky.github.io@master/images/b2t/leimuA.png"' title=回到顶部></div><div class=sidebar_wo id=lamu><img src=https://cdn.jsdelivr.net/gh/lewky/lewky.github.io@master/images/b2t/lamuA.png alt=雷姆 onmouseover='this.src="https://cdn.jsdelivr.net/gh/lewky/lewky.github.io@master/images/b2t/lamuB.png"' onmouseout='this.src="https://cdn.jsdelivr.net/gh/lewky/lewky.github.io@master/images/b2t/lamuA.png"' title=回到底部></div></div><link rel=stylesheet href=/lib/katex/katex.min.css><link rel=stylesheet href=/lib/katex/copy-tex.min.css><link rel=stylesheet href=/lib/cookieconsent/cookieconsent.min.css><script type=text/javascript src=/lib/smooth-scroll/smooth-scroll.min.js></script><script type=text/javascript src=/lib/autocomplete/autocomplete.min.js></script><script type=text/javascript src=/lib/lunr/lunr.min.js></script><script type=text/javascript src=/lib/lunr/lunr.stemmer.support.min.js></script><script type=text/javascript src=/lib/lunr/lunr.zh.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/sharer/sharer.min.js></script><script type=text/javascript src=/lib/katex/katex.min.js></script><script type=text/javascript src=/lib/katex/auto-render.min.js></script><script type=text/javascript src=/lib/katex/copy-tex.min.js></script><script type=text/javascript src=/lib/katex/mhchem.min.js></script><script type=text/javascript src=/lib/cookieconsent/cookieconsent.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:15},comment:{},cookieconsent:{content:{dismiss:"同意",link:"了解更多",message:"本网站使用 Cookies 来改善您的浏览体验."},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{highlightTag:"em",lunrIndexURL:"/index.json",lunrLanguageCode:"zh",lunrSegmentitURL:"/lib/lunr/lunr.segmentit.js",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:50,type:"lunr"}}</script><script type=text/javascript src=/js/theme.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/jquery@2.1.3/dist/jquery.min.js></script><script type=text/javascript src=/js/custom.js></script></body></html>