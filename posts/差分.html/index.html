<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>差分 - Luckyouo Blog</title><meta name=Description content="Luckyouo 的小窝"><meta property="og:title" content="差分"><meta property="og:description" content="前言 差分是前缀和的相对操作，前缀和主要是用在不改变数组的情况下，相反，差分主要用在需要多次改变数组的情况下/ 算法基本思想 计算数组两两元素之间"><meta property="og:type" content="article"><meta property="og:url" content="https://luckyouo.github.io/posts/%E5%B7%AE%E5%88%86.html/"><meta property="og:image" content="https://luckyouo.github.io/logo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-05-19T10:54:59+08:00"><meta property="article:modified_time" content="2022-05-20T08:41:18+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://luckyouo.github.io/logo.png"><meta name=twitter:title content="差分"><meta name=twitter:description content="前言 差分是前缀和的相对操作，前缀和主要是用在不改变数组的情况下，相反，差分主要用在需要多次改变数组的情况下/ 算法基本思想 计算数组两两元素之间"><meta name=application-name content="LoveIt"><meta name=apple-mobile-web-app-title content="LoveIt"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://luckyouo.github.io/posts/%E5%B7%AE%E5%88%86.html/><link rel=prev href=https://luckyouo.github.io/posts/%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE.html/><link rel=next href=https://luckyouo.github.io/posts/ssh-%E6%9C%AC%E5%9C%B0%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91%E5%92%8C%E8%BF%9C%E7%A8%8B%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91.html/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"差分","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/luckyouo.github.io\/posts\/%E5%B7%AE%E5%88%86.html\/"},"genre":"posts","keywords":"差分","wordcount":1506,"url":"https:\/\/luckyouo.github.io\/posts\/%E5%B7%AE%E5%88%86.html\/","datePublished":"2022-05-19T10:54:59+08:00","dateModified":"2022-05-20T08:41:18+08:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"luckyouo"},"description":""}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><a href=https://github.com/luckyouo class=github-corner target=_blank title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="3.5rem" height="3.5rem" viewBox="0 0 250 250" style="fill:#70b7fd;color:#fff;position:absolute;top:0;border:0;left:0;transform:scale(-1,1)" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><div class=header-title><a href=/ title="Luckyouo Blog">Luckyouo Blogs</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>归档 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>分类 </a><a class=menu-item href=/friends/><i class='fas fa-fw fa-fan fa-spin'></i> 友链 </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin"></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Luckyouo Blog">Luckyouo Blogs</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/posts/ title>归档</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/categories/ title>分类</a><a class=menu-item href=/friends/ title><i class='fas fa-fw fa-fan fa-spin'></i>友链</a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class="toc-content always-active" id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animated flipInX">差分</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw"></i>luckyouo</a></span>&nbsp;<span class=post-category>收录于 <a href=/categories/%E7%AE%97%E6%B3%95/><i class="far fa-folder fa-fw"></i>算法</a></span></div><div class=post-meta-line><i class="far fa-calendar fa-fw"></i>&nbsp;<time datetime=2022-05-19>2022-05-19</time>&nbsp;<i class="far fa-calendar-plus fa-fw"></i>&nbsp;<time datetime=2022-05-20>2022-05-20</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 1506 字&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 4 分钟&nbsp;</div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ol><li><a href=#前言>前言</a></li><li><a href=#算法基本思想>算法基本思想</a></li><li><a href=#代码>代码</a><ol><li><a href=#例题一>例题一</a></li><li><a href=#例题二>例题二</a></li><li><a href=#上述题目的线段树解法>上述题目的线段树解法</a></li></ol></li><li><a href=#总结>总结</a></li><li><a href=#参考资料>参考资料</a></li></ol></nav></div></div><div class=content id=content><h2 id=前言>前言</h2><p>差分是前缀和的相对操作，前缀和主要是用在不改变数组的情况下，相反，差分主要用在需要多次改变数组的情况下/</p><h2 id=算法基本思想>算法基本思想</h2><p>计算数组两两元素之间的差，构成差分数组，其中第一个元素取数组第一个元素的值。</p><p>$$b_i = a_i - a_{i-1}$$</p><p>且后续可以通过差分数组的前缀和恢复数组</p><p>$$a_i = \sum_1^i b_i$$</p><p>当需要对某个区间的元素统一进行操作时，比如对区间 $[c, d]$的所有元素增加 k，则只需要进行如下操作：</p><p>$$b_c = b_c + k$$</p><p>$$b_d = b_d - k$$</p><p>即可以完成对区间内所有元素操作。将 $O(k)$ 的操作的时间复杂度降低至 $O(1)$ 。若存在频繁的更改区间操作时，则可以大幅降低时间复杂度。</p><p>可以将差分数组转换为前缀和数组</p><p>$$sum = \sum_i^na_i = \sum_{i=1}^n\sum_{j=1}^ib_j=\sum_{i=1}^n(n-i+1)*b_i$$</p><h2 id=代码>代码</h2><h3 id=例题一>例题一</h3><p><a href=https://leetcode.cn/problems/my-calendar-ii/ target=_blank rel="noopener noreffer">731. 我的日程安排表 II</a></p><p>每次预定一个时间段，意味着那个时间段的访问次数 $+1$ ，所以判断三重预定，则只需要将该区间段 $+1$ 再统计所有区间是否有次数超过三次的，有则预定失败，删除，否则返回 $true$ 。利用 java 的 $TreeMap$ 顺序遍历既可以实现上述要求。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>class</span> <span class=nc>MyCalendarTwo</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>TreeMap</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>,</span> <span class=n>Integer</span><span class=o>&gt;</span> <span class=n>delta</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>MyCalendarTwo</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>delta</span> <span class=o>=</span> <span class=k>new</span> <span class=n>TreeMap</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>book</span><span class=o>(</span><span class=kt>int</span> <span class=n>start</span><span class=o>,</span> <span class=kt>int</span> <span class=n>end</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>delta</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>start</span><span class=o>,</span> <span class=n>delta</span><span class=o>.</span><span class=na>getOrDefault</span><span class=o>(</span><span class=n>start</span><span class=o>,</span> <span class=mi>0</span><span class=o>)</span> <span class=o>+</span> <span class=mi>1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>delta</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>end</span><span class=o>,</span> <span class=n>delta</span><span class=o>.</span><span class=na>getOrDefault</span><span class=o>(</span><span class=n>end</span><span class=o>,</span> <span class=mi>0</span><span class=o>)</span> <span class=o>-</span> <span class=mi>1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>active</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>d</span><span class=o>:</span> <span class=n>delta</span><span class=o>.</span><span class=na>values</span><span class=o>())</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>active</span> <span class=o>+=</span> <span class=n>d</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=o>(</span><span class=n>active</span> <span class=o>&gt;=</span> <span class=mi>3</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=n>delta</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>start</span><span class=o>,</span> <span class=n>delta</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>start</span><span class=o>)</span> <span class=o>-</span> <span class=mi>1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                <span class=n>delta</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>end</span><span class=o>,</span> <span class=n>delta</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>end</span><span class=o>)</span> <span class=o>+</span> <span class=mi>1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                <span class=c1>// if (delta.get(start) == 0)
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=c1>//     delta.remove(start);
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=k>return</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=例题二>例题二</h3><p><a href=https://leetcode.cn/problems/my-calendar-iii/ target=_blank rel="noopener noreffer">732. 我的日程安排表 III</a></p><p>和上题类似，由于不需要判断是否成功，所以只需要将所给的区间段 $+1$ ，在顺序统计区间段的最大的访问次数。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>class</span> <span class=nc>MyCalendarThree</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>TreeMap</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>,</span> <span class=n>Integer</span><span class=o>&gt;</span> <span class=n>map</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>max</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>MyCalendarThree</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>map</span> <span class=o>=</span> <span class=k>new</span> <span class=n>TreeMap</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>book</span><span class=o>(</span><span class=kt>int</span> <span class=n>start</span><span class=o>,</span> <span class=kt>int</span> <span class=n>end</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>map</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>start</span><span class=o>,</span> <span class=n>map</span><span class=o>.</span><span class=na>getOrDefault</span><span class=o>(</span><span class=n>start</span><span class=o>,</span> <span class=mi>0</span><span class=o>)</span> <span class=o>+</span> <span class=mi>1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>map</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>end</span><span class=o>,</span> <span class=n>map</span><span class=o>.</span><span class=na>getOrDefault</span><span class=o>(</span><span class=n>end</span><span class=o>,</span> <span class=mi>0</span><span class=o>)</span> <span class=o>-</span> <span class=mi>1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>count</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=o>(</span><span class=n>Integer</span> <span class=n>value</span> <span class=o>:</span> <span class=n>map</span><span class=o>.</span><span class=na>values</span><span class=o>())</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>count</span> <span class=o>+=</span> <span class=n>value</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=n>max</span> <span class=o>=</span> <span class=n>Math</span><span class=o>.</span><span class=na>max</span><span class=o>(</span><span class=n>count</span> <span class=o>,</span> <span class=n>max</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>max</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=上述题目的线段树解法>上述题目的线段树解法</h3><p>差分和线段树都是应用于区间更改操作的数据结构，因此也可以使用线段树解决。但题目给的范围过大，直接初始化线段树内存会爆，因此可以采用动态开点的线段树。上述两题的线段树代码如下：</p><p>例题一的线段树解法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>class</span> <span class=nc>MyCalendarTwo</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>class</span> <span class=nc>Node</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>ls</span><span class=o>,</span> <span class=n>rs</span><span class=o>,</span> <span class=n>add</span><span class=o>,</span> <span class=n>max</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>N</span> <span class=o>=</span> <span class=o>(</span><span class=kt>int</span><span class=o>)</span><span class=mf>1e9</span><span class=o>,</span> <span class=n>M</span> <span class=o>=</span> <span class=mi>120010</span><span class=o>,</span> <span class=n>cnt</span> <span class=o>=</span> <span class=mi>1</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=n>Node</span><span class=o>[]</span> <span class=n>tr</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Node</span><span class=o>[</span><span class=n>M</span><span class=o>];</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>update</span><span class=o>(</span><span class=kt>int</span> <span class=n>u</span><span class=o>,</span> <span class=kt>int</span> <span class=n>lc</span><span class=o>,</span> <span class=kt>int</span> <span class=n>rc</span><span class=o>,</span> <span class=kt>int</span> <span class=n>l</span><span class=o>,</span> <span class=kt>int</span> <span class=n>r</span><span class=o>,</span> <span class=kt>int</span> <span class=n>v</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>l</span> <span class=o>&lt;=</span> <span class=n>lc</span> <span class=o>&amp;&amp;</span> <span class=n>rc</span> <span class=o>&lt;=</span> <span class=n>r</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>tr</span><span class=o>[</span><span class=n>u</span><span class=o>].</span><span class=na>add</span> <span class=o>+=</span> <span class=n>v</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=n>tr</span><span class=o>[</span><span class=n>u</span><span class=o>].</span><span class=na>max</span> <span class=o>+=</span> <span class=n>v</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=n>lazyCreate</span><span class=o>(</span><span class=n>u</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>pushdown</span><span class=o>(</span><span class=n>u</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>mid</span> <span class=o>=</span> <span class=n>lc</span> <span class=o>+</span> <span class=n>rc</span> <span class=o>&gt;&gt;</span> <span class=mi>1</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>l</span> <span class=o>&lt;=</span> <span class=n>mid</span><span class=o>)</span> <span class=n>update</span><span class=o>(</span><span class=n>tr</span><span class=o>[</span><span class=n>u</span><span class=o>].</span><span class=na>ls</span><span class=o>,</span> <span class=n>lc</span><span class=o>,</span> <span class=n>mid</span><span class=o>,</span> <span class=n>l</span><span class=o>,</span> <span class=n>r</span><span class=o>,</span> <span class=n>v</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>r</span> <span class=o>&gt;</span> <span class=n>mid</span><span class=o>)</span> <span class=n>update</span><span class=o>(</span><span class=n>tr</span><span class=o>[</span><span class=n>u</span><span class=o>].</span><span class=na>rs</span><span class=o>,</span> <span class=n>mid</span> <span class=o>+</span> <span class=mi>1</span><span class=o>,</span> <span class=n>rc</span><span class=o>,</span> <span class=n>l</span><span class=o>,</span> <span class=n>r</span><span class=o>,</span> <span class=n>v</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>pushup</span><span class=o>(</span><span class=n>u</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=nf>query</span><span class=o>(</span><span class=kt>int</span> <span class=n>u</span><span class=o>,</span> <span class=kt>int</span> <span class=n>lc</span><span class=o>,</span> <span class=kt>int</span> <span class=n>rc</span><span class=o>,</span> <span class=kt>int</span> <span class=n>l</span><span class=o>,</span> <span class=kt>int</span> <span class=n>r</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>l</span> <span class=o>&lt;=</span> <span class=n>lc</span> <span class=o>&amp;&amp;</span> <span class=n>rc</span> <span class=o>&lt;=</span> <span class=n>r</span><span class=o>)</span> <span class=k>return</span> <span class=n>tr</span><span class=o>[</span><span class=n>u</span><span class=o>].</span><span class=na>max</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=n>lazyCreate</span><span class=o>(</span><span class=n>u</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>pushdown</span><span class=o>(</span><span class=n>u</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>mid</span> <span class=o>=</span> <span class=n>lc</span> <span class=o>+</span> <span class=n>rc</span> <span class=o>&gt;&gt;</span> <span class=mi>1</span><span class=o>,</span> <span class=n>ans</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>l</span> <span class=o>&lt;=</span> <span class=n>mid</span><span class=o>)</span> <span class=n>ans</span> <span class=o>=</span> <span class=n>Math</span><span class=o>.</span><span class=na>max</span><span class=o>(</span><span class=n>ans</span><span class=o>,</span> <span class=n>query</span><span class=o>(</span><span class=n>tr</span><span class=o>[</span><span class=n>u</span><span class=o>].</span><span class=na>ls</span><span class=o>,</span> <span class=n>lc</span><span class=o>,</span> <span class=n>mid</span><span class=o>,</span> <span class=n>l</span><span class=o>,</span> <span class=n>r</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>r</span> <span class=o>&gt;</span> <span class=n>mid</span><span class=o>)</span> <span class=n>ans</span> <span class=o>=</span> <span class=n>Math</span><span class=o>.</span><span class=na>max</span><span class=o>(</span><span class=n>ans</span><span class=o>,</span> <span class=n>query</span><span class=o>(</span><span class=n>tr</span><span class=o>[</span><span class=n>u</span><span class=o>].</span><span class=na>rs</span><span class=o>,</span> <span class=n>mid</span> <span class=o>+</span> <span class=mi>1</span><span class=o>,</span> <span class=n>rc</span><span class=o>,</span> <span class=n>l</span><span class=o>,</span> <span class=n>r</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>ans</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>lazyCreate</span><span class=o>(</span><span class=kt>int</span> <span class=n>u</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>tr</span><span class=o>[</span><span class=n>u</span><span class=o>]</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=n>tr</span><span class=o>[</span><span class=n>u</span><span class=o>]</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Node</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>tr</span><span class=o>[</span><span class=n>u</span><span class=o>].</span><span class=na>ls</span> <span class=o>==</span> <span class=mi>0</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>tr</span><span class=o>[</span><span class=n>u</span><span class=o>].</span><span class=na>ls</span> <span class=o>=</span> <span class=o>++</span><span class=n>cnt</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=n>tr</span><span class=o>[</span><span class=n>tr</span><span class=o>[</span><span class=n>u</span><span class=o>].</span><span class=na>ls</span><span class=o>]</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Node</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>tr</span><span class=o>[</span><span class=n>u</span><span class=o>].</span><span class=na>rs</span> <span class=o>==</span> <span class=mi>0</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>tr</span><span class=o>[</span><span class=n>u</span><span class=o>].</span><span class=na>rs</span> <span class=o>=</span> <span class=o>++</span><span class=n>cnt</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=n>tr</span><span class=o>[</span><span class=n>tr</span><span class=o>[</span><span class=n>u</span><span class=o>].</span><span class=na>rs</span><span class=o>]</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Node</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>pushup</span><span class=o>(</span><span class=kt>int</span> <span class=n>u</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>tr</span><span class=o>[</span><span class=n>u</span><span class=o>].</span><span class=na>max</span> <span class=o>=</span> <span class=n>Math</span><span class=o>.</span><span class=na>max</span><span class=o>(</span><span class=n>tr</span><span class=o>[</span><span class=n>tr</span><span class=o>[</span><span class=n>u</span><span class=o>].</span><span class=na>ls</span><span class=o>].</span><span class=na>max</span><span class=o>,</span> <span class=n>tr</span><span class=o>[</span><span class=n>tr</span><span class=o>[</span><span class=n>u</span><span class=o>].</span><span class=na>rs</span><span class=o>].</span><span class=na>max</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>pushdown</span><span class=o>(</span><span class=kt>int</span> <span class=n>u</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>tr</span><span class=o>[</span><span class=n>tr</span><span class=o>[</span><span class=n>u</span><span class=o>].</span><span class=na>ls</span><span class=o>].</span><span class=na>add</span> <span class=o>+=</span> <span class=n>tr</span><span class=o>[</span><span class=n>u</span><span class=o>].</span><span class=na>add</span><span class=o>;</span> <span class=n>tr</span><span class=o>[</span><span class=n>tr</span><span class=o>[</span><span class=n>u</span><span class=o>].</span><span class=na>rs</span><span class=o>].</span><span class=na>add</span> <span class=o>+=</span> <span class=n>tr</span><span class=o>[</span><span class=n>u</span><span class=o>].</span><span class=na>add</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=n>tr</span><span class=o>[</span><span class=n>tr</span><span class=o>[</span><span class=n>u</span><span class=o>].</span><span class=na>ls</span><span class=o>].</span><span class=na>max</span> <span class=o>+=</span> <span class=n>tr</span><span class=o>[</span><span class=n>u</span><span class=o>].</span><span class=na>add</span><span class=o>;</span> <span class=n>tr</span><span class=o>[</span><span class=n>tr</span><span class=o>[</span><span class=n>u</span><span class=o>].</span><span class=na>rs</span><span class=o>].</span><span class=na>max</span> <span class=o>+=</span> <span class=n>tr</span><span class=o>[</span><span class=n>u</span><span class=o>].</span><span class=na>add</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=n>tr</span><span class=o>[</span><span class=n>u</span><span class=o>].</span><span class=na>add</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>book</span><span class=o>(</span><span class=kt>int</span> <span class=n>start</span><span class=o>,</span> <span class=kt>int</span> <span class=n>end</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>query</span><span class=o>(</span><span class=mi>1</span><span class=o>,</span> <span class=mi>1</span><span class=o>,</span> <span class=n>N</span> <span class=o>+</span> <span class=mi>1</span><span class=o>,</span> <span class=n>start</span> <span class=o>+</span> <span class=mi>1</span><span class=o>,</span> <span class=n>end</span><span class=o>)</span> <span class=o>&gt;=</span> <span class=mi>2</span><span class=o>)</span> <span class=k>return</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=n>update</span><span class=o>(</span><span class=mi>1</span><span class=o>,</span> <span class=mi>1</span><span class=o>,</span> <span class=n>N</span> <span class=o>+</span> <span class=mi>1</span><span class=o>,</span> <span class=n>start</span> <span class=o>+</span> <span class=mi>1</span><span class=o>,</span> <span class=n>end</span><span class=o>,</span> <span class=mi>1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>例题二的线段树解法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>class</span> <span class=nc>MyCalendarThree</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>class</span> <span class=nc>Node</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>ls</span><span class=o>,</span> <span class=n>rs</span><span class=o>,</span> <span class=n>add</span><span class=o>,</span> <span class=n>max</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>N</span> <span class=o>=</span> <span class=o>(</span><span class=kt>int</span><span class=o>)</span><span class=mf>1e9</span><span class=o>,</span> <span class=n>M</span> <span class=o>=</span> <span class=mi>4</span> <span class=o>*</span> <span class=mi>400</span> <span class=o>*</span> <span class=mi>20</span><span class=o>,</span> <span class=n>cnt</span> <span class=o>=</span> <span class=mi>1</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=n>Node</span><span class=o>[]</span> <span class=n>tr</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Node</span><span class=o>[</span><span class=n>M</span><span class=o>];</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>update</span><span class=o>(</span><span class=kt>int</span> <span class=n>u</span><span class=o>,</span> <span class=kt>int</span> <span class=n>lc</span><span class=o>,</span> <span class=kt>int</span> <span class=n>rc</span><span class=o>,</span> <span class=kt>int</span> <span class=n>l</span><span class=o>,</span> <span class=kt>int</span> <span class=n>r</span><span class=o>,</span> <span class=kt>int</span> <span class=n>v</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>l</span> <span class=o>&lt;=</span> <span class=n>lc</span> <span class=o>&amp;&amp;</span> <span class=n>rc</span> <span class=o>&lt;=</span> <span class=n>r</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>tr</span><span class=o>[</span><span class=n>u</span><span class=o>].</span><span class=na>add</span> <span class=o>+=</span> <span class=n>v</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=n>tr</span><span class=o>[</span><span class=n>u</span><span class=o>].</span><span class=na>max</span> <span class=o>+=</span> <span class=n>v</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=n>lazyCreate</span><span class=o>(</span><span class=n>u</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>pushdown</span><span class=o>(</span><span class=n>u</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>mid</span> <span class=o>=</span> <span class=n>lc</span> <span class=o>+</span> <span class=n>rc</span> <span class=o>&gt;&gt;</span> <span class=mi>1</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>l</span> <span class=o>&lt;=</span> <span class=n>mid</span><span class=o>)</span> <span class=n>update</span><span class=o>(</span><span class=n>tr</span><span class=o>[</span><span class=n>u</span><span class=o>].</span><span class=na>ls</span><span class=o>,</span> <span class=n>lc</span><span class=o>,</span> <span class=n>mid</span><span class=o>,</span> <span class=n>l</span><span class=o>,</span> <span class=n>r</span><span class=o>,</span> <span class=n>v</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>r</span> <span class=o>&gt;</span> <span class=n>mid</span><span class=o>)</span> <span class=n>update</span><span class=o>(</span><span class=n>tr</span><span class=o>[</span><span class=n>u</span><span class=o>].</span><span class=na>rs</span><span class=o>,</span> <span class=n>mid</span> <span class=o>+</span> <span class=mi>1</span><span class=o>,</span> <span class=n>rc</span><span class=o>,</span> <span class=n>l</span><span class=o>,</span> <span class=n>r</span><span class=o>,</span> <span class=n>v</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>pushup</span><span class=o>(</span><span class=n>u</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=nf>query</span><span class=o>(</span><span class=kt>int</span> <span class=n>u</span><span class=o>,</span> <span class=kt>int</span> <span class=n>lc</span><span class=o>,</span> <span class=kt>int</span> <span class=n>rc</span><span class=o>,</span> <span class=kt>int</span> <span class=n>l</span><span class=o>,</span> <span class=kt>int</span> <span class=n>r</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>l</span> <span class=o>&lt;=</span> <span class=n>lc</span> <span class=o>&amp;&amp;</span> <span class=n>rc</span> <span class=o>&lt;=</span> <span class=n>r</span><span class=o>)</span> <span class=k>return</span> <span class=n>tr</span><span class=o>[</span><span class=n>u</span><span class=o>].</span><span class=na>max</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=n>lazyCreate</span><span class=o>(</span><span class=n>u</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>pushdown</span><span class=o>(</span><span class=n>u</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>mid</span> <span class=o>=</span> <span class=n>lc</span> <span class=o>+</span> <span class=n>rc</span> <span class=o>&gt;&gt;</span> <span class=mi>1</span><span class=o>,</span> <span class=n>ans</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>l</span> <span class=o>&lt;=</span> <span class=n>mid</span><span class=o>)</span> <span class=n>ans</span> <span class=o>=</span> <span class=n>Math</span><span class=o>.</span><span class=na>max</span><span class=o>(</span><span class=n>ans</span><span class=o>,</span> <span class=n>query</span><span class=o>(</span><span class=n>tr</span><span class=o>[</span><span class=n>u</span><span class=o>].</span><span class=na>ls</span><span class=o>,</span> <span class=n>lc</span><span class=o>,</span> <span class=n>mid</span><span class=o>,</span> <span class=n>l</span><span class=o>,</span> <span class=n>r</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>r</span> <span class=o>&gt;</span> <span class=n>mid</span><span class=o>)</span> <span class=n>ans</span> <span class=o>=</span> <span class=n>Math</span><span class=o>.</span><span class=na>max</span><span class=o>(</span><span class=n>ans</span><span class=o>,</span> <span class=n>query</span><span class=o>(</span><span class=n>tr</span><span class=o>[</span><span class=n>u</span><span class=o>].</span><span class=na>rs</span><span class=o>,</span> <span class=n>mid</span> <span class=o>+</span> <span class=mi>1</span><span class=o>,</span> <span class=n>rc</span><span class=o>,</span> <span class=n>l</span><span class=o>,</span> <span class=n>r</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>ans</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>lazyCreate</span><span class=o>(</span><span class=kt>int</span> <span class=n>u</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>tr</span><span class=o>[</span><span class=n>u</span><span class=o>]</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=n>tr</span><span class=o>[</span><span class=n>u</span><span class=o>]</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Node</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>tr</span><span class=o>[</span><span class=n>u</span><span class=o>].</span><span class=na>ls</span> <span class=o>==</span> <span class=mi>0</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>tr</span><span class=o>[</span><span class=n>u</span><span class=o>].</span><span class=na>ls</span> <span class=o>=</span> <span class=o>++</span><span class=n>cnt</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=n>tr</span><span class=o>[</span><span class=n>tr</span><span class=o>[</span><span class=n>u</span><span class=o>].</span><span class=na>ls</span><span class=o>]</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Node</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>tr</span><span class=o>[</span><span class=n>u</span><span class=o>].</span><span class=na>rs</span> <span class=o>==</span> <span class=mi>0</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>tr</span><span class=o>[</span><span class=n>u</span><span class=o>].</span><span class=na>rs</span> <span class=o>=</span> <span class=o>++</span><span class=n>cnt</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=n>tr</span><span class=o>[</span><span class=n>tr</span><span class=o>[</span><span class=n>u</span><span class=o>].</span><span class=na>rs</span><span class=o>]</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Node</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>pushdown</span><span class=o>(</span><span class=kt>int</span> <span class=n>u</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>tr</span><span class=o>[</span><span class=n>tr</span><span class=o>[</span><span class=n>u</span><span class=o>].</span><span class=na>ls</span><span class=o>].</span><span class=na>add</span> <span class=o>+=</span> <span class=n>tr</span><span class=o>[</span><span class=n>u</span><span class=o>].</span><span class=na>add</span><span class=o>;</span> <span class=n>tr</span><span class=o>[</span><span class=n>tr</span><span class=o>[</span><span class=n>u</span><span class=o>].</span><span class=na>rs</span><span class=o>].</span><span class=na>add</span> <span class=o>+=</span> <span class=n>tr</span><span class=o>[</span><span class=n>u</span><span class=o>].</span><span class=na>add</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=n>tr</span><span class=o>[</span><span class=n>tr</span><span class=o>[</span><span class=n>u</span><span class=o>].</span><span class=na>ls</span><span class=o>].</span><span class=na>max</span> <span class=o>+=</span> <span class=n>tr</span><span class=o>[</span><span class=n>u</span><span class=o>].</span><span class=na>add</span><span class=o>;</span> <span class=n>tr</span><span class=o>[</span><span class=n>tr</span><span class=o>[</span><span class=n>u</span><span class=o>].</span><span class=na>rs</span><span class=o>].</span><span class=na>max</span> <span class=o>+=</span> <span class=n>tr</span><span class=o>[</span><span class=n>u</span><span class=o>].</span><span class=na>add</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=n>tr</span><span class=o>[</span><span class=n>u</span><span class=o>].</span><span class=na>add</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>pushup</span><span class=o>(</span><span class=kt>int</span> <span class=n>u</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>tr</span><span class=o>[</span><span class=n>u</span><span class=o>].</span><span class=na>max</span> <span class=o>=</span> <span class=n>Math</span><span class=o>.</span><span class=na>max</span><span class=o>(</span><span class=n>tr</span><span class=o>[</span><span class=n>tr</span><span class=o>[</span><span class=n>u</span><span class=o>].</span><span class=na>ls</span><span class=o>].</span><span class=na>max</span><span class=o>,</span> <span class=n>tr</span><span class=o>[</span><span class=n>tr</span><span class=o>[</span><span class=n>u</span><span class=o>].</span><span class=na>rs</span><span class=o>].</span><span class=na>max</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>book</span><span class=o>(</span><span class=kt>int</span> <span class=n>start</span><span class=o>,</span> <span class=kt>int</span> <span class=n>end</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>update</span><span class=o>(</span><span class=mi>1</span><span class=o>,</span> <span class=mi>1</span><span class=o>,</span> <span class=n>N</span> <span class=o>+</span> <span class=mi>1</span><span class=o>,</span> <span class=n>start</span> <span class=o>+</span> <span class=mi>1</span><span class=o>,</span> <span class=n>end</span><span class=o>,</span> <span class=mi>1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>query</span><span class=o>(</span><span class=mi>1</span><span class=o>,</span> <span class=mi>1</span><span class=o>,</span> <span class=n>N</span> <span class=o>+</span> <span class=mi>1</span><span class=o>,</span> <span class=mi>1</span><span class=o>,</span> <span class=n>N</span> <span class=o>+</span> <span class=mi>1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=总结>总结</h2><p>差分的适用情况与线段树、柱状数组情况类似，但代码更加简洁。差分难点主要在和其他算法一起结合使用，而不是单独的使用差分思想。</p><h2 id=参考资料>参考资料</h2><p><a href=https://oi-wiki.org/basic/prefix-sum/#_6 target=_blank rel="noopener noreffer">前缀和 & 差分</a></p><p><a href=https://www.cnblogs.com/zhwer/p/12800475.html target=_blank rel="noopener noreffer">浅谈差分和树上差分算法的基本应用</a></p><p><a href=https://labuladong.gitee.io/algo/2/18/23/ target=_blank rel="noopener noreffer">小而美的算法技巧：差分数组</a></p><p><a href=https://leetcode.cn/problems/my-calendar-ii/ target=_blank rel="noopener noreffer">731. 我的日程安排表 II</a></p><p><a href=https://leetcode.cn/problems/my-calendar-iii/ target=_blank rel="noopener noreffer">732. 我的日程安排表 III</a></p><p><a href=https://leetcode.cn/problems/my-calendar-ii/solution/by-ac_oier-okkc/ target=_blank rel="noopener noreffer">【宫水三叶】线段树（动态开点）运用题</a></p><p><a href=https://leetcode.cn/problems/my-calendar-iii/solution/by-ac_oier-cv31/ target=_blank rel="noopener noreffer">【宫水三叶】线段树（动态开点）运用题</a></p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2022-05-20</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/posts/%E5%B7%AE%E5%88%86.html/index.md target=_blank>阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://luckyouo.github.io/posts/%E5%B7%AE%E5%88%86.html/ data-title=差分 data-hashtags=差分><i class="fab fa-twitter fa-fw"></i></a><a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://luckyouo.github.io/posts/%E5%B7%AE%E5%88%86.html/ data-hashtag=差分><i class="fab fa-facebook-square fa-fw"></i></a><a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://luckyouo.github.io/posts/%E5%B7%AE%E5%88%86.html/ data-title=差分><i class="fab fa-weibo fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/%E5%B7%AE%E5%88%86/>差分</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/posts/%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE.html/ class=prev rel=prev title=二分查找><i class="fas fa-angle-left fa-fw"></i>二分查找</a>
<a href=/posts/ssh-%E6%9C%AC%E5%9C%B0%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91%E5%92%8C%E8%BF%9C%E7%A8%8B%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91.html/ class=next rel=next title="SSH 本地端口转发和远程端口转发">SSH 本地端口转发和远程端口转发<i class="fas fa-angle-right fa-fw"></i></a></div></div><div id=comments></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line><span id=run-time></span></div><div class=footer-line>由 <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.111.3">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2022 - 2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>luckyouo</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw"></i></a></div><div class=sidebar_wo><div id=leimu><img src=https://cdn.jsdelivr.net/gh/lewky/lewky.github.io@master/images/b2t/leimuA.png alt=雷姆 onmouseover='this.src="https://cdn.jsdelivr.net/gh/lewky/lewky.github.io@master/images/b2t/leimuB.png"' onmouseout='this.src="https://cdn.jsdelivr.net/gh/lewky/lewky.github.io@master/images/b2t/leimuA.png"' title=回到顶部></div><div class=sidebar_wo id=lamu><img src=https://cdn.jsdelivr.net/gh/lewky/lewky.github.io@master/images/b2t/lamuA.png alt=雷姆 onmouseover='this.src="https://cdn.jsdelivr.net/gh/lewky/lewky.github.io@master/images/b2t/lamuB.png"' onmouseout='this.src="https://cdn.jsdelivr.net/gh/lewky/lewky.github.io@master/images/b2t/lamuA.png"' title=回到底部></div></div><link rel=stylesheet href=/lib/katex/katex.min.css><link rel=stylesheet href=/lib/katex/copy-tex.min.css><link rel=stylesheet href=/lib/cookieconsent/cookieconsent.min.css><script type=text/javascript src=/lib/smooth-scroll/smooth-scroll.min.js></script><script type=text/javascript src=/lib/autocomplete/autocomplete.min.js></script><script type=text/javascript src=/lib/lunr/lunr.min.js></script><script type=text/javascript src=/lib/lunr/lunr.stemmer.support.min.js></script><script type=text/javascript src=/lib/lunr/lunr.zh.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/sharer/sharer.min.js></script><script type=text/javascript src=/lib/katex/katex.min.js></script><script type=text/javascript src=/lib/katex/auto-render.min.js></script><script type=text/javascript src=/lib/katex/copy-tex.min.js></script><script type=text/javascript src=/lib/katex/mhchem.min.js></script><script type=text/javascript src=/lib/cookieconsent/cookieconsent.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:15},comment:{},cookieconsent:{content:{dismiss:"同意",link:"了解更多",message:"本网站使用 Cookies 来改善您的浏览体验."},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{highlightTag:"em",lunrIndexURL:"/index.json",lunrLanguageCode:"zh",lunrSegmentitURL:"/lib/lunr/lunr.segmentit.js",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:50,type:"lunr"}}</script><script type=text/javascript src=/js/theme.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/jquery@2.1.3/dist/jquery.min.js></script><script type=text/javascript src=/js/custom.js></script></body></html>