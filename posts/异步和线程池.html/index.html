<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>异步和线程池 - Luckyouo Blog</title><meta name=Description content="Luckyouo 的小窝"><meta property="og:title" content="异步和线程池"><meta property="og:description" content="前言 同步是指当方法一旦被调用就必须等待方法执行完才可以继续向下执行其他操作，而异步不关心方法的执行过程，触发要调用的方法后就继续向下执行其他"><meta property="og:type" content="article"><meta property="og:url" content="https://luckyouo.github.io/posts/%E5%BC%82%E6%AD%A5%E5%92%8C%E7%BA%BF%E7%A8%8B%E6%B1%A0.html/"><meta property="og:image" content="https://luckyouo.github.io/logo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-04-26T13:07:42+08:00"><meta property="article:modified_time" content="2023-04-26T14:07:38+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://luckyouo.github.io/logo.png"><meta name=twitter:title content="异步和线程池"><meta name=twitter:description content="前言 同步是指当方法一旦被调用就必须等待方法执行完才可以继续向下执行其他操作，而异步不关心方法的执行过程，触发要调用的方法后就继续向下执行其他"><meta name=application-name content="LoveIt"><meta name=apple-mobile-web-app-title content="LoveIt"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://luckyouo.github.io/posts/%E5%BC%82%E6%AD%A5%E5%92%8C%E7%BA%BF%E7%A8%8B%E6%B1%A0.html/><link rel=prev href=https://luckyouo.github.io/posts/feign-%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8.html/><link rel=next href=https://luckyouo.github.io/posts/sentinel-%E7%86%94%E6%96%AD%E9%99%8D%E7%BA%A7.html/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"异步和线程池","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/luckyouo.github.io\/posts\/%E5%BC%82%E6%AD%A5%E5%92%8C%E7%BA%BF%E7%A8%8B%E6%B1%A0.html\/"},"genre":"posts","keywords":"线程池, 异步","wordcount":1679,"url":"https:\/\/luckyouo.github.io\/posts\/%E5%BC%82%E6%AD%A5%E5%92%8C%E7%BA%BF%E7%A8%8B%E6%B1%A0.html\/","datePublished":"2023-04-26T13:07:42+08:00","dateModified":"2023-04-26T14:07:38+08:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"luckyouo"},"description":""}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><a href=https://github.com/luckyouo class=github-corner target=_blank title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="3.5rem" height="3.5rem" viewBox="0 0 250 250" style="fill:#70b7fd;color:#fff;position:absolute;top:0;border:0;left:0;transform:scale(-1,1)" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><div class=header-title><a href=/ title="Luckyouo Blog">Luckyouo Blogs</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>归档 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>分类 </a><a class=menu-item href=/friends/><i class='fas fa-fw fa-fan fa-spin'></i> 友链 </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin"></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Luckyouo Blog">Luckyouo Blogs</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/posts/ title>归档</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/categories/ title>分类</a><a class=menu-item href=/friends/ title><i class='fas fa-fw fa-fan fa-spin'></i>友链</a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class="toc-content always-active" id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animated flipInX">异步和线程池</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw"></i>luckyouo</a></span>&nbsp;<span class=post-category>收录于 <a href=/categories/spring-boot/><i class="far fa-folder fa-fw"></i>Spring Boot</a></span></div><div class=post-meta-line><i class="far fa-calendar fa-fw"></i>&nbsp;<time datetime=2023-04-26>2023-04-26</time>&nbsp;<i class="far fa-calendar-plus fa-fw"></i>&nbsp;<time datetime=2023-04-26>2023-04-26</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 1679 字&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 4 分钟&nbsp;</div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ol><li><a href=#前言>前言</a></li><li><a href=#线程>线程</a></li><li><a href=#线程池>线程池</a><ol><li><a href=#线程池的7大参数>线程池的7大参数</a></li><li><a href=#内置四大线程池阿里巴巴规范不建议使用有-oom-风险>内置四大线程池（阿里巴巴规范不建议使用，有 OOM 风险）</a></li></ol></li><li><a href=#异步>异步</a><ol><li><a href=#异步任务创建>异步任务创建</a></li><li><a href=#异步任务编排>异步任务编排</a></li></ol></li><li><a href=#参考资料>参考资料</a></li></ol></nav></div></div><div class=content id=content><h2 id=前言>前言</h2><p>同步是指当方法一旦被调用就必须等待方法执行完才可以继续向下执行其他操作，而异步不关心方法的执行过程，触发要调用的方法后就继续向下执行其他操作，不会像同步那样必须阻塞至方法结束才继续。</p><p>实现异步则需要开启一个新的线程。</p><h2 id=线程>线程</h2><p>Java 初始化线程主要有四种方式：</p><ol><li>继承 Thread</li><li>实现 Runnable 接口</li><li>实现 Callable 接口 + FutureTask</li><li>线程池</li></ol><p>前两种方法无法获取新的线程结果，第三种方法可以获取线程的结果</p><p>线程的创建和销毁都需要占用系统资源，所以，在实际应该过程中，应该通过线程池来获取新的线程。</p><h2 id=线程池>线程池</h2><h3 id=线程池的7大参数>线程池的7大参数</h3><ol><li>@param corePoolSize：池中一直保持的线程的数量，即使线程空闲。除非设置了 allowCoreThreadTimeOut</li><li>@param maximumPoolSize：池中允许的最大的线程数</li><li>@param keepAliveTime：当线程数大于核心线程数的时候，线程在最大多长时间没有接到新任务就会终止释放， 最终线程池维持在 corePoolSize 大小</li><li>@param unit：时间单位</li><li>@param workQueue：阻塞队列，用来存储等待执行的任务，如果当前对线程的需求超过了 corePoolSize 大小，就会放在这里等待空闲线程执行。</li><li>@param threadFactory：创建线程的工厂，比如指定线程名等</li><li>@param handler：拒绝策略，如果线程满了，线程池就会使用拒绝策略。</li></ol><p>运行流程：</p><ol><li>线程池创建，准备好 core 数量的核心线程，准备接受任务</li><li>新的任务进来，用 core 准备好的空闲线程执行。<ol><li>core 满了，就将再进来的任务放入阻塞队列中。空闲的 core 就会自己去阻塞队列获取任务执行</li><li>阻塞队列满了，就直接开新线程执行，最大只能开到 max 指定的数量</li><li>max 都执行好了。Max-core 数量空闲的线程会在 keepAliveTime 指定的时间后自动销毁，最终保持到 core 大小</li><li>如果线程数开到了 max 的数量，还有新任务进来，就会使用 reject 指定的拒绝策 略进行处理</li></ol></li></ol><p>所有的线程创建都是由指定的 factory 创建的。</p><h3 id=内置四大线程池阿里巴巴规范不建议使用有-oom-风险>内置四大线程池（阿里巴巴规范不建议使用，有 OOM 风险）</h3><ul><li>newCachedThreadPool：创建一个可缓存线程池，如果线程池长度超过处理需要，可灵活回收空闲线程，若 无可回收，则新建线程。</li><li>newFixedThreadPool：创建一个定长线程池，可控制线程最大并发数，超出的线程会在队列中等待。</li><li>newScheduledThreadPool：创建一个定长线程池，支持定时及周期性任务执行</li><li>newSingleThreadExecutor：创建一个单线程化的线程池，它只会用唯一的工作线程来执行任务，保证所有任务 按照指定顺序(FIFO, LIFO, 优先级)执行。</li></ul><p>上述四个线程池最大线程池数量为 Integer.MAX_VALUE ，所以可能会出现 OOM 情况</p><p>根据阿里巴巴的规范，建议使用7大参数自己构建</p><h2 id=异步>异步</h2><h3 id=异步任务创建>异步任务创建</h3><p>使用 CompletableFuture 工具类进行异步任务编排</p><p>该工具类提供了四个静态方法创建来创建异步任务：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>static</span> <span class=o>&lt;</span><span class=n>U</span><span class=o>&gt;</span> <span class=n>CompletableFuture</span><span class=o>&lt;</span><span class=n>U</span><span class=o>&gt;</span> <span class=nf>supplyAsync</span><span class=o>(</span><span class=n>Supplier</span><span class=o>&lt;</span><span class=n>U</span><span class=o>&gt;</span> <span class=n>supplier</span><span class=o>,</span> <span class=n>Executor</span> <span class=n>executor</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>static</span> <span class=n>CompletableFuture</span><span class=o>&lt;</span><span class=n>Void</span><span class=o>&gt;</span> <span class=nf>runAsync</span><span class=o>(</span><span class=n>Runnable</span> <span class=n>runnable</span><span class=o>,</span> <span class=n>Executor</span> <span class=n>executor</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>static</span> <span class=o>&lt;</span><span class=n>U</span><span class=o>&gt;</span> <span class=n>CompletableFuture</span><span class=o>&lt;</span><span class=n>U</span><span class=o>&gt;</span> <span class=nf>supplyAsync</span><span class=o>(</span><span class=n>Supplier</span><span class=o>&lt;</span><span class=n>U</span><span class=o>&gt;</span> <span class=n>supplier</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>static</span> <span class=n>CompletableFuture</span><span class=o>&lt;</span><span class=n>Void</span><span class=o>&gt;</span> <span class=nf>runAsync</span><span class=o>(</span><span class=n>Runnable</span> <span class=n>runnable</span><span class=o>);</span>
</span></span></code></pre></td></tr></table></div></div><p>前两个使用自己的线程池创建异步任务，而后者则根据 CPU 的核数创建同步线程池，推荐使用自己的线程池。</p><p>run 开头的方法创建的异步任务都没有返回值，而 supply 创建的带有返回结果。</p><p>任务完成后可指定回调方法</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>CompletionStage</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=nf>whenComplete</span><span class=o>(</span><span class=n>BiConsumer</span><span class=o>&lt;?</span> <span class=kd>super</span> <span class=n>T</span><span class=o>,?</span> <span class=kd>super</span> <span class=n>Throwable</span><span class=o>&gt;</span> <span class=n>action</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>CompletionStage</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=nf>whenCompleteAsync</span><span class=o>(</span><span class=n>BiConsumer</span><span class=o>&lt;?</span> <span class=kd>super</span> <span class=n>T</span><span class=o>,?</span> <span class=kd>super</span> <span class=n>Throwable</span><span class=o>&gt;</span> <span class=n>action</span><span class=o>,</span> <span class=n>Executor</span> <span class=n>executor</span><span class=o>)</span><span class=err>；</span>
</span></span></code></pre></td></tr></table></div></div><p>使用 whenComplete 开头的方法可以指定某个任务在一个任务结束之后（包括异常结束）。</p><p>已 Async 结束的方法表示后续任务已开线新的线程进行，而没有 Async 的则在同一个线程中继续进行，<strong>后续方法类似该规则命名</strong></p><p>可以通过 handle 方法修改线程返回的结果</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=o>&lt;</span><span class=n>U</span><span class=o>&gt;</span> <span class=n>CompletionStage</span><span class=o>&lt;</span><span class=n>U</span><span class=o>&gt;</span> <span class=nf>handle</span><span class=o>(</span><span class=n>BiFunction</span><span class=o>&lt;?</span> <span class=kd>super</span> <span class=n>T</span><span class=o>,</span><span class=n>Throwable</span><span class=o>,?</span> <span class=kd>extends</span> <span class=n>U</span><span class=o>&gt;</span> <span class=n>fn</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>&lt;</span><span class=n>U</span><span class=o>&gt;</span> <span class=n>CompletionStage</span><span class=o>&lt;</span><span class=n>U</span><span class=o>&gt;</span> <span class=nf>handleAsync</span><span class=o>(</span><span class=n>BiFunction</span><span class=o>&lt;?</span> <span class=kd>super</span> <span class=n>T</span><span class=o>,</span><span class=n>Throwable</span><span class=o>,?</span> <span class=kd>extends</span> <span class=n>U</span><span class=o>&gt;</span> <span class=n>fn</span><span class=o>,</span> <span class=n>Executor</span> <span class=n>executor</span><span class=o>);</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=异步任务编排>异步任务编排</h3><ol><li>顺序编排</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>CompletionStage</span><span class=o>&lt;</span><span class=n>Void</span><span class=o>&gt;</span> <span class=nf>thenRun</span><span class=o>(</span><span class=n>Runnable</span> <span class=n>action</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>CompletionStage</span><span class=o>&lt;</span><span class=n>Void</span><span class=o>&gt;</span> <span class=nf>thenRunAsync</span><span class=o>(</span><span class=n>Runnable</span> <span class=n>action</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>CompletionStage</span><span class=o>&lt;</span><span class=n>Void</span><span class=o>&gt;</span> <span class=nf>thenRunAsync</span><span class=o>(</span><span class=n>Runnable</span> <span class=n>action</span><span class=o>,</span> <span class=n>Executor</span> <span class=n>executor</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>CompletionStage</span><span class=o>&lt;</span><span class=n>Void</span><span class=o>&gt;</span> <span class=nf>thenAccept</span><span class=o>(</span><span class=n>Consumer</span><span class=o>&lt;?</span> <span class=kd>super</span> <span class=n>T</span><span class=o>&gt;</span> <span class=n>action</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>CompletionStage</span><span class=o>&lt;</span><span class=n>Void</span><span class=o>&gt;</span> <span class=nf>thenAcceptAsync</span><span class=o>(</span><span class=n>Consumer</span><span class=o>&lt;?</span> <span class=kd>super</span> <span class=n>T</span><span class=o>&gt;</span> <span class=n>action</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>CompletionStage</span><span class=o>&lt;</span><span class=n>Void</span><span class=o>&gt;</span> <span class=nf>thenAcceptAsync</span><span class=o>(</span><span class=n>Consumer</span><span class=o>&lt;?</span> <span class=kd>super</span> <span class=n>T</span><span class=o>&gt;</span> <span class=n>action</span><span class=o>,</span> <span class=n>Executor</span> <span class=n>executor</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>&lt;</span><span class=n>U</span><span class=o>&gt;</span> <span class=n>CompletionStage</span><span class=o>&lt;</span><span class=n>U</span><span class=o>&gt;</span> <span class=nf>thenApply</span><span class=o>(</span><span class=n>Function</span><span class=o>&lt;?</span> <span class=kd>super</span> <span class=n>T</span><span class=o>,?</span> <span class=kd>extends</span> <span class=n>U</span><span class=o>&gt;</span> <span class=n>fn</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>&lt;</span><span class=n>U</span><span class=o>&gt;</span> <span class=n>CompletionStage</span><span class=o>&lt;</span><span class=n>U</span><span class=o>&gt;</span> <span class=nf>thenApplyAsync</span><span class=o>(</span><span class=n>Function</span><span class=o>&lt;?</span> <span class=kd>super</span> <span class=n>T</span><span class=o>,?</span> <span class=kd>extends</span> <span class=n>U</span><span class=o>&gt;</span> <span class=n>fn</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>&lt;</span><span class=n>U</span><span class=o>&gt;</span> <span class=n>CompletionStage</span><span class=o>&lt;</span><span class=n>U</span><span class=o>&gt;</span> <span class=nf>thenApplyAsync</span><span class=o>(</span><span class=n>Function</span><span class=o>&lt;?</span> <span class=kd>super</span> <span class=n>T</span><span class=o>,?</span> <span class=kd>extends</span> <span class=n>U</span><span class=o>&gt;</span> <span class=n>fn</span><span class=o>,</span> <span class=n>Executor</span> <span class=n>executor</span><span class=o>);</span>
</span></span></code></pre></td></tr></table></div></div><p>run 开头方法不需要前任务的返回值，accept 开头方法需要前任务的返回值，但后续没有新的返回值，而 apply 开头方法需要前任务的返回值，并提供新的返回值。</p><ol start=2><li>组合编排</li></ol><p>可以编排各个异步任务之前的前后顺序，在 <code>CompletionStage</code> 类中提高了各式 api 接口，具体可以文档参考</p><p>两个常见的组合编排，CompletableFuture 工具类提供如下两个方法</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>static</span> <span class=n>CompletableFuture</span><span class=o>&lt;</span><span class=n>Void</span><span class=o>&gt;</span> <span class=nf>allOf</span><span class=o>(</span><span class=n>CompletableFuture</span><span class=o>&lt;?&gt;...</span> <span class=n>cfs</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>static</span> <span class=n>CompletableFuture</span><span class=o>&lt;</span><span class=n>Object</span><span class=o>&gt;</span> <span class=nf>anyOf</span><span class=o>(</span><span class=n>CompletableFuture</span><span class=o>&lt;?&gt;...</span> <span class=n>cfs</span><span class=o>);</span>
</span></span></code></pre></td></tr></table></div></div><p>allOf：等待所有任务完成</p><p>anyOf：只要有一个任务完成</p><h2 id=参考资料>参考资料</h2><p><a href=https://www.jianshu.com/p/8c9dc192fa63 target=_blank rel="noopener noreffer">CompletableFuture避坑1——需要自定义线程池</a></p><p><a href="https://www.bilibili.com/video/BV1np4y1C7Yf?p=1&amp;vd_source=b6eb6fd64ed675d7acddef5b0467fac9" target=_blank rel="noopener noreffer">Java项目《谷粒商城》Java架构师 | 微服务 | 大型电商项目</a></p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2023-04-26</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/posts/%E5%BC%82%E6%AD%A5%E5%92%8C%E7%BA%BF%E7%A8%8B%E6%B1%A0.html/index.md target=_blank>阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://luckyouo.github.io/posts/%E5%BC%82%E6%AD%A5%E5%92%8C%E7%BA%BF%E7%A8%8B%E6%B1%A0.html/ data-title=异步和线程池 data-hashtags=线程池,异步><i class="fab fa-twitter fa-fw"></i></a><a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://luckyouo.github.io/posts/%E5%BC%82%E6%AD%A5%E5%92%8C%E7%BA%BF%E7%A8%8B%E6%B1%A0.html/ data-hashtag=线程池><i class="fab fa-facebook-square fa-fw"></i></a><a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://luckyouo.github.io/posts/%E5%BC%82%E6%AD%A5%E5%92%8C%E7%BA%BF%E7%A8%8B%E6%B1%A0.html/ data-title=异步和线程池><i class="fab fa-weibo fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/%E7%BA%BF%E7%A8%8B%E6%B1%A0/>线程池</a>,&nbsp;<a href=/tags/%E5%BC%82%E6%AD%A5/>异步</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/posts/feign-%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8.html/ class=prev rel=prev title="Feign 远程调用"><i class="fas fa-angle-left fa-fw"></i>Feign 远程调用</a>
<a href=/posts/sentinel-%E7%86%94%E6%96%AD%E9%99%8D%E7%BA%A7.html/ class=next rel=next title="Sentinel 熔断降级">Sentinel 熔断降级<i class="fas fa-angle-right fa-fw"></i></a></div></div><div id=comments></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line><span id=run-time></span></div><div class=footer-line>由 <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.111.3">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2022 - 2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>luckyouo</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw"></i></a></div><div class=sidebar_wo><div id=leimu><img src=https://cdn.jsdelivr.net/gh/lewky/lewky.github.io@master/images/b2t/leimuA.png alt=雷姆 onmouseover='this.src="https://cdn.jsdelivr.net/gh/lewky/lewky.github.io@master/images/b2t/leimuB.png"' onmouseout='this.src="https://cdn.jsdelivr.net/gh/lewky/lewky.github.io@master/images/b2t/leimuA.png"' title=回到顶部></div><div class=sidebar_wo id=lamu><img src=https://cdn.jsdelivr.net/gh/lewky/lewky.github.io@master/images/b2t/lamuA.png alt=雷姆 onmouseover='this.src="https://cdn.jsdelivr.net/gh/lewky/lewky.github.io@master/images/b2t/lamuB.png"' onmouseout='this.src="https://cdn.jsdelivr.net/gh/lewky/lewky.github.io@master/images/b2t/lamuA.png"' title=回到底部></div></div><link rel=stylesheet href=/lib/katex/katex.min.css><link rel=stylesheet href=/lib/katex/copy-tex.min.css><link rel=stylesheet href=/lib/cookieconsent/cookieconsent.min.css><script type=text/javascript src=/lib/smooth-scroll/smooth-scroll.min.js></script><script type=text/javascript src=/lib/autocomplete/autocomplete.min.js></script><script type=text/javascript src=/lib/lunr/lunr.min.js></script><script type=text/javascript src=/lib/lunr/lunr.stemmer.support.min.js></script><script type=text/javascript src=/lib/lunr/lunr.zh.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/sharer/sharer.min.js></script><script type=text/javascript src=/lib/katex/katex.min.js></script><script type=text/javascript src=/lib/katex/auto-render.min.js></script><script type=text/javascript src=/lib/katex/copy-tex.min.js></script><script type=text/javascript src=/lib/katex/mhchem.min.js></script><script type=text/javascript src=/lib/cookieconsent/cookieconsent.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:15},comment:{},cookieconsent:{content:{dismiss:"同意",link:"了解更多",message:"本网站使用 Cookies 来改善您的浏览体验."},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{highlightTag:"em",lunrIndexURL:"/index.json",lunrLanguageCode:"zh",lunrSegmentitURL:"/lib/lunr/lunr.segmentit.js",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:50,type:"lunr"}}</script><script type=text/javascript src=/js/theme.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/jquery@2.1.3/dist/jquery.min.js></script><script type=text/javascript src=/js/custom.js></script></body></html>